var v=Object.defineProperty;var S=(t,s,e)=>s in t?v(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var o=(t,s,e)=>S(t,typeof s!="symbol"?s+"":s,e);import{j as n,C as u,e as _}from"./index-BfyQISR3.js";import{b as c,d as R,N as b}from"./vendor_react-BhSUrOfD.js";import{W as I}from"./index-DHOhpgNa.js";const k="_Main_6rwql_1",y={Main:k},P="_Status_btvvi_1",w={Status:P},N=({className:t,children:s})=>n.jsx("h4",{className:w.Status,children:n.jsx("span",{className:t,children:s})}),p=c.memo(N),E="_Title_18vma_2",L={Title:E},M=({className:t,title:s,children:e})=>n.jsx("div",{className:L.Title,children:n.jsxs("span",{className:t,children:[n.jsx("h1",{children:s}),n.jsx("h3",{children:e})]})}),F=c.memo(M),q="_Form_5krnw_1",A={Form:q},D="_TextInput_1xfaq_1",O={TextInput:D},W=({className:t,name:s,value:e,changed:r,placeholder:a,required:i,focus:l})=>n.jsx("span",{className:O.TextInput,children:n.jsx("input",{type:"text",className:t,name:s,value:e,onChange:r,placeholder:a,required:i,autoFocus:l})}),G=c.memo(W),H=({className:t,name:s,value:e,changed:r,placeholder:a,required:i,focus:l},$)=>n.jsx(G,{className:t,name:s,value:e,changed:r,placeholder:a,required:i,focus:l},$),J=({inputs:t})=>t instanceof Array?t.map(H):null,U=c.memo(J),z=({className:t,submited:s,children:e,textInputList:r,submitText:a,locked:i})=>n.jsx("div",{className:A.Form,children:n.jsx("span",{className:t,children:n.jsxs("form",{onSubmit:s,children:[e,n.jsx(U,{inputs:r}),n.jsx("input",{type:"submit",value:a,disabled:i})]})})}),B=c.memo(z),K=({error:t,route:s})=>{if(t)return n.jsxs("span",{children:["Error trying to generate link.",n.jsx("br",{}),t instanceof Error?t.message:t]});if(s){const e=`${u.server}/@/${s}`;return n.jsxs("span",{children:["Generated at ",n.jsx("a",{href:e,children:e})]})}return n.jsx(n.Fragment,{})};class m{constructor(s,e){o(this,"route");o(this,"error");o(this,"generate",()=>m.build(this.route,this.error));this.error=e,this.route=s}static build(s,e){return n.jsx(K,{error:e,route:s})}}const Q="Nothing returned",d=new Headers({"Content-Type":"application/json","Access-Control-Allow-Origin":"*"});class h{}o(h,"count",()=>{const s=new Request(`${u.server}/count`,{method:"GET",headers:d});return T(s,10).then(x)}),o(h,"shorten",(s,e)=>{const r=new Request(u.server,{method:"POST",body:JSON.stringify({link:s,shrt:e}),headers:d});return fetch(r).then(x).then(a=>a?Promise.resolve(j(a.shrt)):Promise.reject(Q)).catch(a=>X(a).then(i=>Promise.resolve(j(null,i))))});const T=(t,s,e)=>fetch(t).catch(r=>s===1?Promise.reject(r):V(5e3).then(()=>T(t,s-1))),V=t=>new Promise(s=>setTimeout(s,t)),x=t=>t.ok?t.json():Promise.reject(t.json()),X=t=>(t instanceof Promise?t:Promise.resolve(t)).then(e=>Promise.resolve(e instanceof Error?e.message:e)),j=(t,s)=>m.build(t,s),g="Please enter a link to shorten",C="Waiting for server calculations...";class Y extends c.PureComponent{constructor(){super(...arguments);o(this,"state",{link:"",shrt:"",response:g,loading:!1,countResponse:C});o(this,"getStatus",()=>this.state.loading?"Loading...":this.state.response);o(this,"getTextInputList",()=>[{name:"link",value:this.state.link,changed:this.handleInputChange,placeholder:"🌐 Enter the long URL",required:!0,focus:!0},{name:"shrt",value:this.state.shrt,changed:this.handleInputChange,placeholder:"🌐 Custom alias (optional)"}]);o(this,"setLoading",(e=!0)=>this.setState({loading:e}));o(this,"setCountResponse",e=>this.setState({countResponse:e}));o(this,"setResponse",(e=g)=>this.setState({response:e}));o(this,"callCount",()=>h.count().then(e=>this.setCountResponse(`There are ${e} shortened links!`)).catch(e=>{console.error(e),this.setCountResponse("An error has occurred!")}));o(this,"handleInputChange",e=>{e.preventDefault();const{name:r,type:a,checked:i,value:l}=e.target;this.setState({[r]:a==="checkbox"?i:l})});o(this,"shorten",e=>{e.preventDefault();const{link:r,shrt:a}=this.state;if(!r){this.setResponse();return}this.setLoading(),this.setCountResponse(C),h.shorten(r,a).then(i=>{this.setResponse(i),this.setLoading(!1),this.callCount()})})}componentDidMount(){this.callCount()}render(){return n.jsxs(I,{children:[n.jsx(F,{title:"Shrtr",children:"The independent shortener"}),n.jsx(p,{children:this.state.countResponse}),n.jsx(p,{children:this.getStatus()}),n.jsx(B,{submited:this.shorten,locked:this.state.loading,submitText:"Shorten 🔗",textInputList:this.getTextInputList()})]})}}const Z="_Color_c0j15_1",tt={Color:Z},et=16777215,f=()=>{const t=`#${Math.floor(et*Math.random()).toString(16).padStart(6,"0")}`;document.documentElement.style.setProperty("--main-bg-color",t)},st=()=>(c.useEffect(()=>{f()},[]),n.jsx("input",{className:tt.Color,type:"button",value:"New Color 🎨",onClick:f})),nt=c.memo(st),ct=()=>R().search==="?error"?n.jsx(b,{to:_}):n.jsxs("div",{className:y.Main,children:[n.jsx(nt,{}),n.jsx(Y,{})]});export{ct as default};
