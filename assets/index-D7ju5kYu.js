var $=Object.defineProperty;var S=(t,e,s)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var o=(t,e,s)=>S(t,typeof e!="symbol"?e+"":e,s);import{j as n,C as d,e as _}from"./index-DcYa5TOe.js";import{b as c,d as R,N as y}from"./vendor_react-DQZwDAyu.js";import{W as I}from"./index-Apk5Qnof.js";const b="_Main_6rwql_1",k={Main:b},w="_Status_btvvi_1",N={Status:w},P=({className:t,children:e})=>n.jsx("h4",{className:N.Status,children:n.jsx("span",{className:t,children:e})}),m=c.memo(P),L="_Title_18vma_2",E={Title:L},M=({className:t,title:e,children:s})=>n.jsx("div",{className:E.Title,children:n.jsxs("span",{className:t,children:[n.jsx("h1",{children:e}),n.jsx("h3",{children:s})]})}),F=c.memo(M),q="_Form_5krnw_1",A={Form:q},O="_TextInput_1xfaq_1",D={TextInput:O},W=({className:t,name:e,value:s,changed:r,placeholder:a,required:i,focus:l})=>n.jsx("span",{className:D.TextInput,children:n.jsx("input",{type:"text",className:t,name:e,value:s,onChange:r,placeholder:a,required:i,autoFocus:l})}),G=c.memo(W),J=({className:t,name:e,value:s,changed:r,placeholder:a,required:i,focus:l},v)=>n.jsx(G,{className:t,name:e,value:s,changed:r,placeholder:a,required:i,focus:l},v),H=({inputs:t})=>t instanceof Array?t.map(J):null,U=c.memo(H),z=({className:t,submited:e,children:s,textInputList:r,submitText:a,locked:i})=>n.jsx("div",{className:A.Form,children:n.jsx("span",{className:t,children:n.jsxs("form",{onSubmit:e,children:[s,n.jsx(U,{inputs:r}),n.jsx("input",{type:"submit",value:a,disabled:i})]})})}),B=c.memo(z),K=({error:t,route:e})=>{if(t)return console.error(t),n.jsxs("span",{children:["Error trying to generate link.",n.jsx("br",{}),t instanceof Error?t.message:t]});if(e){const s=`${d.server}/@/${e}`;return n.jsxs("span",{children:["Generated at ",n.jsx("a",{href:s,children:s})]})}return n.jsx(n.Fragment,{})};class p{constructor(e,s){o(this,"route");o(this,"error");o(this,"generate",()=>p.build(this.route,this.error));this.error=s,this.route=e}static build(e,s){return n.jsx(K,{error:s,route:e})}}const Q="Nothing returned",x=new Headers({"Content-Type":"application/json","Access-Control-Allow-Origin":"*"});class h{}o(h,"count",()=>{const e=new Request(`${d.server}/count`,{method:"GET",headers:x});return T(e,10).then(j)}),o(h,"shorten",(e,s)=>{const r=new Request(d.server,{method:"POST",body:JSON.stringify({link:e,shrt:s.length===0?void 0:s}),headers:x});return fetch(r).then(j).then(a=>a?Promise.resolve(u(a.shrt)):Promise.resolve(u(null,Q))).catch(a=>Promise.resolve(u(null,a)))});const T=(t,e,s)=>fetch(t).catch(r=>e===1?Promise.reject(r):V(5e3).then(()=>T(t,e-1))),V=t=>new Promise(e=>setTimeout(e,t)),j=async t=>{try{const e=await t.json();return t.ok?Promise.resolve(e):Promise.reject(e)}catch{return Promise.reject("Invalid JSON")}},u=(t,e)=>p.build(t,e),g="Please enter a link to shorten",C="Waiting for server calculations...";class X extends c.PureComponent{constructor(){super(...arguments);o(this,"state",{link:"",shrt:"",response:g,loading:!1,countResponse:C});o(this,"getStatus",()=>this.state.loading?"Loading...":this.state.response);o(this,"getTextInputList",()=>[{name:"link",value:this.state.link,changed:this.handleInputChange,placeholder:"🌐 Enter the long URL",required:!0,focus:!0},{name:"shrt",value:this.state.shrt,changed:this.handleInputChange,placeholder:"🌐 Custom alias (optional)"}]);o(this,"setLoading",(s=!0)=>this.setState({loading:s}));o(this,"setCountResponse",s=>this.setState({countResponse:s}));o(this,"setResponse",(s=g)=>this.setState({response:s}));o(this,"callCount",()=>h.count().then(s=>this.setCountResponse(`There are ${s} shortened links!`)).catch(s=>{console.error(s),this.setCountResponse("An error has occurred!")}));o(this,"handleInputChange",s=>{s.preventDefault();const{name:r,type:a,checked:i,value:l}=s.target;this.setState({[r]:a==="checkbox"?i:l})});o(this,"shorten",s=>{s.preventDefault();const{link:r,shrt:a}=this.state;if(!r){this.setResponse();return}this.setLoading(),this.setCountResponse(C),h.shorten(r,a).then(i=>{this.setResponse(i),this.setLoading(!1),this.callCount()})})}componentDidMount(){this.callCount()}render(){return n.jsxs(I,{children:[n.jsx(F,{title:"Shrtr",children:"The independent shortener"}),n.jsx(m,{children:this.state.countResponse}),n.jsx(m,{children:this.getStatus()}),n.jsx(B,{submited:this.shorten,locked:this.state.loading,submitText:"Shorten 🔗",textInputList:this.getTextInputList()})]})}}const Y="_Color_c0j15_1",Z={Color:Y},tt=16777215,f=()=>{const t=`#${Math.floor(tt*Math.random()).toString(16).padStart(6,"0")}`;document.documentElement.style.setProperty("--main-bg-color",t)},et=()=>(c.useEffect(()=>{f()},[]),n.jsx("input",{className:Z.Color,type:"button",value:"New Color 🎨",onClick:f})),st=c.memo(et),it=()=>R().search==="?error"?n.jsx(y,{to:_}):n.jsxs("div",{className:k.Main,children:[n.jsx(st,{}),n.jsx(X,{})]});export{it as default};
