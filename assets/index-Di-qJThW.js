import{j as s,C as h,e as v}from"./index-BQvstSlH.js";import{b as a,d as T,N as $}from"./vendor_react-BYfT73dN.js";import{W as _}from"./index-kzjlzF8-.js";const R="_Main_6rwql_1",y={Main:R},I="_Status_btvvi_1",b={Status:I},k=({className:e,children:t})=>s.jsx("h4",{className:b.Status,children:s.jsx("span",{className:e,children:t})}),d=a.memo(k),w="_Title_18vma_2",N={Title:w},P=({className:e,title:t,children:n})=>s.jsx("div",{className:N.Title,children:s.jsxs("span",{className:e,children:[s.jsx("h1",{children:t}),s.jsx("h3",{children:n})]})}),L=a.memo(P),E="_Form_5krnw_1",M={Form:E},F="_TextInput_1xfaq_1",q={TextInput:F},A=({className:e,name:t,value:n,changed:r,placeholder:o,required:i,focus:c})=>s.jsx("span",{className:q.TextInput,children:s.jsx("input",{type:"text",className:e,name:t,value:n,onChange:r,placeholder:o,required:i,autoFocus:c})}),O=a.memo(A),D=({className:e,name:t,value:n,changed:r,placeholder:o,required:i,focus:c},S)=>s.jsx(O,{className:e,name:t,value:n,changed:r,placeholder:o,required:i,focus:c},S),W=({inputs:e})=>e instanceof Array?e.map(D):null,G=a.memo(W),J=({className:e,submited:t,children:n,textInputList:r,submitText:o,locked:i})=>s.jsx("div",{className:M.Form,children:s.jsx("span",{className:e,children:s.jsxs("form",{onSubmit:t,children:[n,s.jsx(G,{inputs:r}),s.jsx("input",{type:"submit",value:o,disabled:i})]})})}),H=a.memo(J),U=({error:e,route:t})=>{if(e)return console.error(e),s.jsxs("span",{children:["Error trying to generate link.",s.jsx("br",{}),e instanceof Error?e.message:e]});if(t){const n=`${h.server}/@/${t}`;return s.jsxs("span",{children:["Generated at ",s.jsx("a",{href:n,children:n})]})}return s.jsx(s.Fragment,{})};class u{route;error;constructor(t,n){this.error=n,this.route=t}generate=()=>u.build(this.route,this.error);static build(t,n){return s.jsx(U,{error:n,route:t})}}const z="Nothing returned",p=new Headers({"Content-Type":"application/json","Access-Control-Allow-Origin":"*"});class m{static count=()=>{const t=new Request(`${h.server}/count`,{method:"GET",headers:p});return f(t,10).then(x)};static shorten=(t,n)=>{const r=new Request(h.server,{method:"POST",body:JSON.stringify({link:t,shrt:n.length===0?void 0:n}),headers:p});return fetch(r).then(x).then(o=>o?Promise.resolve(l(o.shrt)):Promise.resolve(l(null,z))).catch(o=>Promise.resolve(l(null,o)))}}const f=(e,t,n)=>fetch(e).catch(r=>t===1?Promise.reject(r):B(5e3).then(()=>f(e,t-1))),B=e=>new Promise(t=>setTimeout(t,e)),x=async e=>{try{const t=await e.json();return e.ok?Promise.resolve(t):Promise.reject(t)}catch{return Promise.reject("Invalid JSON")}},l=(e,t)=>u.build(e,t),j="Please enter a link to shorten",g="Waiting for server calculations...";class K extends a.PureComponent{state={link:"",shrt:"",response:j,loading:!1,countResponse:g};getStatus=()=>this.state.loading?"Loading...":this.state.response;getTextInputList=()=>[{name:"link",value:this.state.link,changed:this.handleInputChange,placeholder:"🌐 Enter the long URL",required:!0,focus:!0},{name:"shrt",value:this.state.shrt,changed:this.handleInputChange,placeholder:"🌐 Custom alias (optional)"}];setLoading=(t=!0)=>this.setState({loading:t});setCountResponse=t=>this.setState({countResponse:t});setResponse=(t=j)=>this.setState({response:t});callCount=()=>m.count().then(t=>this.setCountResponse(`There are ${t} shortened links!`)).catch(t=>{console.error(t),this.setCountResponse("An error has occurred!")});handleInputChange=t=>{t.preventDefault();const{name:n,type:r,checked:o,value:i}=t.target;this.setState({[n]:r==="checkbox"?o:i})};shorten=t=>{t.preventDefault();const{link:n,shrt:r}=this.state;if(!n){this.setResponse();return}this.setLoading(),this.setCountResponse(g),m.shorten(n,r).then(o=>{this.setResponse(o),this.setLoading(!1),this.callCount()})};componentDidMount(){this.callCount()}render(){return s.jsxs(_,{children:[s.jsx(L,{title:"Shrtr",children:"The independent shortener"}),s.jsx(d,{children:this.state.countResponse}),s.jsx(d,{children:this.getStatus()}),s.jsx(H,{submited:this.shorten,locked:this.state.loading,submitText:"Shorten 🔗",textInputList:this.getTextInputList()})]})}}const Q="_Color_c0j15_1",V={Color:Q},X=16777215,C=()=>{const e=`#${Math.floor(X*Math.random()).toString(16).padStart(6,"0")}`;document.documentElement.style.setProperty("--main-bg-color",e)},Y=()=>(a.useEffect(()=>{C()},[]),s.jsx("input",{className:V.Color,type:"button",value:"New Color 🎨",onClick:C})),Z=a.memo(Y),nt=()=>T().search==="?error"?s.jsx($,{to:v}):s.jsxs("div",{className:y.Main,children:[s.jsx(Z,{}),s.jsx(K,{})]});export{nt as default};
